<html>
<head>
<title>SVG test</title>
  <script type="text/javascript" src="several_countries.js"></script>
  <link type="text/css" href="jquery/jquery-ui-1.8.14.custom.css" rel="stylesheet" />
  <!--
  <script type='text/javascript' src='https://www.google.com/jsapi?key=ABQIAAAAafDALeUVyxhUndZQcT0BRRQjgiEk1Ut90lZbiCSD8tXKcVgrkBQLYOFQ3xwutc5R9SNzfGaKxMnf7g'></script>
  -->
  <style type="text/css">
#ocean-overlay {
  position: absolute;
  top: 100px;
  left:50%;
  width: 800px;
  height: 600px;
  margin-left: -400px;
  border: 1px solid black;
  pointer-events: none;
  background-image: url(rome-bg-5040x3024.png);
  background-repeat: no-repeat;
  background-position: -2220px -550px;
}
  </style>
  <script src="jquery/jquery-1.7.1.min.js" type="text/javascript"></script>
  <script src="jquery/jquery-ui-1.8.14.custom.min.js" type="text/javascript"></script>

  <script type="text/javascript">
    var min = -400;
    var max = end_year;

    function nameToId(name) {
      return name.replace(/ /g, '_');
    }

    function countryMouseOver(e) {
      $('#highlighted-country').html(e.target.getAttribute('readableName'));
      e.target.setAttribute('stroke-width', 20);
    }
    function countryMouseOut(e) {
      $('#highlighted-country').html('');
      e.target.setAttribute('stroke-width', 5);
    }

    var last_drawn_idx = -1;
    function slideToYear(year) {
      var this_year_idx = 0;
      for (var i = 0; i < rome.length; i++) {
        if (rome[i][0] > year) {
          this_year_idx = i - 1;
          break;
        }
      }

      var cum_delta = {};
      var sgn = this_year_idx - last_drawn_idx < 0 ? -1 : +1;
      for (var i = last_drawn_idx + sgn; ; i += sgn) {
        var data = rome[i][1];
        for (var k in data) {
          cum_delta[k] = data[k];
        }
        if (i == this_year_idx) break;
      }
      last_drawn_idx = this_year_idx;

      for (var k in cum_delta) {
        var d = cum_delta[k];
        if (d == '') d = 'M 11445 4535 z';
        $('#' + nameToId(k)).attr("d", d);
      }

      var str = year > 0 ? 'A.D.' : 'B.C.';
      var pct = 100.0 * (year - min) / (max - min);
      $('#year')
          .text('' + Math.abs(year) + ' ' + str)
          .css('left', pct + '%');
    }

    $(function(){
      // create paths for all empires/nations
      for (var k in colors) {
        var el = document.createElementNS("http://www.w3.org/2000/svg", "path");
        el.id = nameToId(k);
        el.setAttribute('readableName', k);
        el.setAttribute('stroke-width', 5);
        el.setAttribute('fill', colors[k]);
        el.setAttribute('stroke-linejoin', 'round');
        el.setAttribute('d', 'M 11445 4535 z');
        // TODO(danvk): use jquery SVG to do this?
        el.onmouseover = countryMouseOver;
        el.onmouseout = countryMouseOut;
        document.getElementById('ctry').appendChild(el);
      }

      $('#slider').slider({
        range: false,
        value: -100,
        min: min,
        max: end_year,
        slide: function(e, ui) {
          slideToYear(ui.value);
        }
        // change: function(event, ui) {
        //   // ...
        // }
      });

      slideToYear(-100);
    });
  </script>
</head>
<body>

<div id="slider" style="position: absolute; left: 20px; top: 10px; right: 20px; height: 14px;"></div>

<div style="position: absolute; left: 20px; top: 40px; right: 20px; height: 40px;">
  <div id="year" style="position: absolute; left: 20px; width: 200px; margin-left: -100px; text-align: center;">100 B.C.</div>
</div>
<div id="highlighted-country" style="position: absolute; top: 150px; left: 20px; width: 200px; font-weight: bold;"></div>

<div style="position: absolute; top: 100px; left:50%; width: 800px; margin-left: -400px; border: 1px solid black;">
<svg width=800 height=600 viewBox='11100 2750 4000 3000'>
  <g id="ctry" stroke="#999999" stroke-width="1" stroke-miterlimit="1" stroke-linejoin="round" stroke-linecap="round">

  </g>
</svg>
</div>

<div id="ocean-overlay"></div>

</body>
</html>
